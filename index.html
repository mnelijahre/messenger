<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Net Messenger</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1 id="title">Dark Net Messenger</h1>
    <div id="formDiv">
        <div id="thing">
            <div class="formRow">
                <h4>Username</h4>
                <input type="text" id="usernameInput">
            </div>
            <div class="formRow">
                <h4>Password</h4>
                <input type="text" id="passwordInput">
            </div>
        </div>
        
        <div class="formRow2">
            <button id="registerBtn">Register</button>
            <button id="loginBtn">Login</button>
            <button id="forgotPass">Forgot Password</button>
        </div>
        <h1 id="helpText"></h1>

    </div>
    <h1 id="footerTitle">Do not use or share sensitive data or passwords</h1>

</body>

<script type="module">
    
    /*=====================================================*/

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {getDatabase, set, get, update, remove, ref, child} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    const firebaseConfig = {
      apiKey: "AIzaSyD-FDKk4cgdYMnkjOqCD6Lm5DUgAeh9Qpc",
      authDomain: "tutorialwebsite-7cd7e.firebaseapp.com",
      databaseURL: "https://tutorialwebsite-7cd7e-default-rtdb.firebaseio.com",
      projectId: "tutorialwebsite-7cd7e",
      storageBucket: "tutorialwebsite-7cd7e.appspot.com",
      messagingSenderId: "122930750292",
      appId: "1:122930750292:web:5f982f3dda769246339ec1"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const dbref = ref(db);

    /*=====================================================*/

    var usernameInput = document.querySelector("#usernameInput");
    var passwordInput = document.querySelector("#passwordInput");
    var registerBtn = document.querySelector('#registerBtn');
    var loginBtn = document.querySelector('#loginBtn');

    const helpText = document.querySelector("#helpText");
    var forgotPass = document.querySelector("#forgotPass");
    var funnyImg = document.querySelector("#funnyImg");
    forgotPass.addEventListener('click', forgotPasswordFunction);
    var count = 0;
    const footerTitle = document.querySelector("#footerTitle");
    function forgotPasswordFunction(){
        forgotPass.classList.add("clear");
        footerTitle.innerHTML = "Do not forget your password";
        console.log(1);
    }

    function register(){
        if (usernameInput.value == "" && passwordInput.value == ""){
            helpText.innerHTML = "Problem: empty user/pass";
        }else {
            get(child(dbref, "Accounts/" + usernameInput.value.toLowerCase())).then(
                (snapshop)=>{
                    if (snapshop.exists()){
                        helpText.innerHTML = ("Existing username");
                    }else{
                        set(child(dbref, "Accounts/" + usernameInput.value.toLowerCase()),{
                            password: passwordInput.value
                        })
                    }
                    usernameInput.value = "";
                    passwordInput.value = "";
                }
            )
        }
    }

    function login(){
        if (usernameInput.value == "" && passwordInput.value == ""){
            helpText.innerHTML = ("Must have at least one character");
        }else {
            var exists = false;
            get(child(dbref, "Accounts/" + usernameInput.value.toLowerCase())).then(
                (snapshot)=>{
                    if (snapshot.exists()){
                        exists = true;
                        if (passwordInput.value == snapshot.val().password){
                            localStorage.setItem("user", usernameInput.value.toLowerCase());
                            window.location.href = "message.html";

                        }else{
                            helpText.innerHTML = ("wrong password");
                        }
                    }
                }
                
            ).then(
                ()=>{
                    if (exists == false){
                helpText.innerHTML = ("user does not exist");
            }
                }
            )
            
        }        
    }

    var testBtn = document.querySelector("#test");


    registerBtn.addEventListener('click',register);
    loginBtn.addEventListener('click', login);


  </script>
</html>